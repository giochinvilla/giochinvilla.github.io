<!DOCTYPE html>
<html lang="it">
<head>

<meta name="description" content="Esplora il mondo avvincente dei giochi da tavolo, Warhammer e giochi di ruolo sul 
nostro sito. Scopri guide, risorse e comunità appassionate per arricchire la tua esperienza ludica. 
Unisciti a noi nel coltivare la passione per l'immaginazione e la strategia, dove ogni dado lanciato porta avventure senza fine. 
Entra nel nostro regno virtuale dedicato agli appassionati di giochi, dove l'unico scopo è condividere la gioia del gioco!.">

<script async src="https://www.googletagmanager.com/gtag/js?id=G-YXSNQ75QND"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YXSNQ75QND');
</script>

  <title>Giochi in Villa</title>
 
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  
  <link rel="stylesheet" href="../../generalCSS.css">
  <link rel="stylesheet" href="../../fonts/fonts.css">
  <link rel="stylesheet" href="../../buttons.css">
  
  <link rel="icon" type="image/x-icon" href="../../images/icons/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <meta charset="utf-8">
  
</head>
<body>
  
  <div class="container-fluid text-center bg-gradient bg-red2 p-2">
	<div class="circle mx-auto">
	  <div><img src='../../images/icons/logo.webp' width="75%"></img></div>
	  <div class="rotatinglogo text-light" style="font-family: 'Typewriter';">
	    <div>Giochi in Villa • Giochi in Villa •</div>
      </div>
    </div>
  </div>
  
  <div class="sticky-top" loadHTML="../../template_containers/nav.html"></div>
  
  <div class="row m-auto">
    <div class="col-xl-9 ps-xl-5 p-3">

	  <div class="container-fluid p-md-5 p-3 border bg-white shadow">
		<h3>
		  <img alt='Immagine' src='../../images/icons/subtitle-logo.webp' style='width:28px; margin-right: 10px;'></img>
		  <span class='badge bg-danger rounded-pill text-white'>ISCRIZIONE</span>
		  <span> Evento GDR - Santa Maria di Salem<span>
		</h3>
		<hr>

<form class="g-2 needs-validation" id="inputForm" novalidate>
    <div class="accordion shadow">
        <div class="accordion-item">
            <div class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#anagrafica_partecipante" aria-expanded="true" aria-controls="anagrafica_partecipante">
                    <h4>Iscrizione</h4>
                </button>
            </div>
            
            <div id="anagrafica_partecipante" class="accordion-collapse collapse show">
                <div class="accordion-body row">
                    <div class="col-md-6 mb-2">
                        <div class="form-floating">
                            <input id="nome" name="nome" class="form-control" placeholder="" required>
                            <label class="form-label">Nome*</label><div class="invalid-feedback">Inserisci un nome</div>
                        </div>
                    </div>
                    
                    <div class="col-md-6 mb-2">
                        <div class="form-floating">
                            <input id="cognome" name="cognome" class="form-control" placeholder="" required>
                            <label class="form-label">Cognome*</label><div class="invalid-feedback">Inserisci un cognome</div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-2">
                        <div class="form-floating">
                            <input id="telefono" name="telefono" class="form-control" placeholder="">
                            <label class="form-label">Telefono</label><div class="invalid-feedback">Inserisci un numero di telefono</div>
                        </div>
                    </div>
                    
                    <div class="col-md-4 mb-2">
                        <div class="form-floating">
                            <input id="email" name="email" class="form-control" placeholder="">
                            <label class="form-label">Email</label><div class="invalid-feedback">Inserisci un indirizzo email</div>
                        </div>
                    </div>

                    <div class="col-md-4 mb-2">
                        <div class="form-floating">
                            <select id="dropdownMenu" name="opzione" class="form-select" required>
                                <option value="" disabled selected>Seleziona una partita*</option>
                            </select>
                            <label for="dropdownMenu" class="form-label">Partita*</label>
                            <div class="invalid-feedback">Seleziona una partita</div>
                        </div>
                    </div>
					
					<br><br><br><br>
					<div class="col-md-12 mb-2">
					<input type="checkbox" id="dinner" name="dinner" class="form-check-input"> Vuoi, inoltre, unirti a noi per cena con una pizza? <br><sub>(<i>La pizza ha un costo di 10€ da pagare obbligatoriamente entro <b>23/10/2024</b> tramite bonifico al <b>IT95E0832736300000000800568</b> o Paypal a <b>giochinvilla@gmail.com</b></i>)</sub>
					</div>
					
					<br><br><br>
					<h5 id="residui">Seleziona una partita</h5>
					<br><br>
					<div id="gioco"></div>
					<br><br>
					<div id="descrizione"></div>
                </div>
            </div>
        </div>  
    </div>

    <br>
    <hr>
    <div class="mt-4">
        <input type="checkbox" id="gdpr" class="form-check-input" required>
        <label for="gdpr" class="form-check-label">Dichiaro di accettare i termini e le condizioni del trattamento dei dati conformemente alla normativa europea in materia di protezione dei dati (GDPR).</label>
        <div class="invalid-feedback">Devi accettare per poterti iscrivere</div>
    </div>
    <br>
	<h5>Vuoi annullare la tua iscrizione? Mandaci una mail a giochinvilla@gmail.com</h5>
    <br>
    <button id="submit" type="submit" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#exampleModal" disabled>Invia l'iscrizione</button>
</form>
	  </div>
	</div>


	<div class="modal fade" id="exampleModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
	  <div class="modal-dialog">
		<div class="modal-content">
		  <div class="modal-header">
			<h1 class="modal-title fs-5" id="exampleModalLabel"><img alt='Immagine' src='../../images/icons/subtitle-logo.webp' style='width:28px; margin-right: 10px;'></img>Invio dell'iscrizione!</h1>
		  </div>
		  <div id="modalText" class="p-3">
			<div class="modal-body d-flex justify-content-center">
			  <div class="spinner-border" role="status">
				<span class="visually-hidden">Caricamento...</span>
			  </div>
			</div>
		  </div>
		  <div class="modal-footer" id="modal-footer">
			<a href='#' class='btn btn-primary text-white' role='button'>Esci</a>
		  </div>
		</div>
	  </div>
	</div>
	
	<div class="modal fade" id="loadingModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="loadingModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="loadingModalLabel">
                    <img alt='Immagine' src='../../images/icons/subtitle-logo.webp' style='width:28px; margin-right: 10px;'></img>
                    Caricamento in corso
                </h1>
            </div>
            <div class="modal-body d-flex justify-content-center">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Caricamento...</span>
                </div>
            </div>
        </div>
    </div>
</div>
	
	<div class="col-xl-3 pe-xl-5 p-3">  
	  <div loadHTML="../../template_containers/social.html"></div>
    </div>
  </div>
  
  <nav class="navbar navbar-expand-sm bg-dark navbar-dark text-secondary">
    <div class="ps-3">
		Powered by Github - Made by Vice<br>
	</div>
  </nav>

<script>

  function loadExternalHTML() {
	var z, i, elmnt, file, xhttp;
	z = document.getElementsByTagName("*");
	for (i = 0; i < z.length; i++) {
		elmnt = z[i];
		file = elmnt.getAttribute("loadHTML");
		if (file) {
			xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4) {
				if (this.status == 200) {elmnt.innerHTML = this.responseText;}
				if (this.status == 404) {elmnt.innerHTML = "";}
				elmnt.removeAttribute("loadHTML");
				loadExternalHTML();
				}
			}      
			xhttp.open("GET", file, true);
			xhttp.send();
			return;
			}
		}
	};

  loadExternalHTML();

const text = document.querySelector(".rotatinglogo");
	    text.innerHTML = text.innerText
	    .split("")
	    .map(
		  (char, i) => `<span style="transform:rotate(${i * 10.3}deg)">${char}</span>`
	    ).join("");
		
		
    document.addEventListener("DOMContentLoaded", function() {
    // Mostra il modal di caricamento
    var loadingModal = new bootstrap.Modal(document.getElementById('loadingModal'), {
        backdrop: 'static',
        keyboard: false
    });
    loadingModal.show();

    fetch("https://script.google.com/macros/s/AKfycbwWUwNR8SMX7cx9_UFN8P-p1id0R4pdaR29fDSzGUWIh46Q-mGjvOv6l4ajlzBPD48URA/exec", {
        method: "GET",
        redirect: "follow",
        headers: {
            "Content-Type": "text/plain;charset=utf-8"
        }
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
    })
    .then(data => {
        // Nascondi il modal di caricamento quando i dati vengono recuperati con successo
        loadingModal.hide();

        const dropdown = document.getElementById("dropdownMenu");


            if (Array.isArray(data) && data.length > 0) {
                data.forEach((item, index) => {
                    const option = document.createElement("option");
                    option.value = index;
                    option.textContent = item.campagna;
                    dropdown.appendChild(option);
                });

                const displayDetails = (index) => {
                    const selectedItem = data[index];
                    document.getElementById("residui").textContent = selectedItem.residui;
                    document.getElementById("gioco").innerHTML = "<b>Gioco:</b> " + selectedItem.gioco;
                    document.getElementById("descrizione").innerHTML = "<b>Descrizione:</b> " + selectedItem.descrizione;

                    const actionButton = document.getElementById("submit");
                    actionButton.disabled = selectedItem.residui === "Posti Esauriti ❌";
                };

                dropdown.addEventListener("change", function() {
                    const selectedIndex = this.value;
                    displayDetails(selectedIndex);
                });
            } else {
                console.warn("No data to populate the dropdown.");
            }
        })
        .catch(error => {
            console.error("Errore nel recupero dei dati:", error);
            alert("Errore nel recupero dei dati");
        });
    });

    document.getElementById('inputForm').addEventListener('submit', function(event) { 
        if (!this.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
            this.classList.add('was-validated');
            document.getElementById("modalText").innerHTML = "<h2 class='fs-5'><i class='fa fa-exclamation-triangle'></i> Errore</h2>Completa tutti i dati necessari prima di inviare!";
            document.getElementById("modal-footer").innerHTML = "<button type='button' class='btn btn-primary' data-bs-dismiss='modal'>Esci</button>";
            return;
        }

        event.preventDefault(); 
        var formData = new FormData(this); 

        // Add the selected dropdown value to the FormData
        const selectedDropdownValue = document.getElementById("dropdownMenu").value;
        formData.append("campagna", selectedDropdownValue); // Add selected value as "selectedOpzione"

        fetch('https://script.google.com/macros/s/AKfycbwWUwNR8SMX7cx9_UFN8P-p1id0R4pdaR29fDSzGUWIh46Q-mGjvOv6l4ajlzBPD48URA/exec', { 
			method: 'POST', 
			body: formData 
		}) 
		.then(response => response.text()) // Read the response body as text
		.then(text => {
			console.log('Server response:', text);

			// Handle the "Campagna is Full" case
			if (text === 'Campagna is Full') {
				document.getElementById("modalText").innerHTML = "<h2 class='fs-5'><i class='fa fa-exclamation-triangle'></i> Posti Finiti</h2>Mi dispiace, ma nel frattempo che inviavi l'iscrizione qualcuno ti ha preceduto!";
				document.getElementById("modal-footer").innerHTML = "<a href='../../index.html' class='btn btn-primary text-white' role='button'>Esci</a>";
			} 
			// Handle success case
			else {
				document.getElementById("modalText").innerHTML = "<h2 class='fs-5'><i class='fa fa-check-circle-o'></i> Congratulazioni!</h2>La tua iscrizione è stata inviata con successo!";
				document.getElementById("modal-footer").innerHTML = "<a href='../../index.html' class='btn btn-primary text-white' role='button'>Esci</a>";
			}
		})
		.catch(error => { 
			console.error('Error:', error); 
			document.getElementById("modalText").innerHTML = "<h2 class='fs-5'><i class='fa fa-exclamation-triangle'></i> Errore Critico</h2>La tua iscrizione non è stata ricevuta correttamente!<br>Se questo errore persiste contatta un amministratore!";
			document.getElementById("modal-footer").innerHTML = "<a href='#' class='btn btn-primary text-white' role='button'>Esci</a>";
		});
    }); 

    (() => {
        'use strict'
        const forms = document.querySelectorAll('.needs-validation')
        Array.from(forms).forEach(form => {
            form.addEventListener('submit', event => {
                if (!form.checkValidity()) {
                    event.preventDefault()
                    event.stopPropagation()
                }
                form.classList.add('was-validated')
            }, false)
        })
    })()
</script>

</body>
</html>